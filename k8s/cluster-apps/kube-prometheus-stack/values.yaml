kube-prometheus-stack:
  alertmanager:
    config:
      global:
        resolve_timeout: 5m
        inhibit_rules:
          - source_matchers:
              - 'severity = critical'
            target_matchers:
              - 'severity =~ warning|info'
            equal:
              - 'namespace'
              - 'alertname'
          - source_matchers:
              - 'severity = warning'
            target_matchers:
              - 'severity = info'
            equal:
              - 'namespace'
              - 'alertname'
          - source_matchers:
              - 'alertname = InfoInhibitor'
            target_matchers:
              - 'severity = info'
            equal:
              - 'namespace'
        route:
          group_by: ['namespace']
          group_wait: 30s
          group_interval: 5m
          repeat_interval: 12h
          receiver: 'monitoring/telegram-alerts/telegram'
          routes:
          - receiver: 'monitoring/telegram-alerts/telegram'
            matchers:
              - 'alertname =~ "InfoInhibitor|Watchdog"'
          - receiver: 'monitoring/telegram-alerts/telegram'
            matchers:
              - 'severity =~ "warning|info"'
        receivers:
        - name: 'monitoring/telegram-alerts/telegram'
        templates:
        - '/etc/alertmanager/config/*.tmpl'

    alertmanagerSpec:
      alertmanagerConfigSelector:
        matchLabels:
          alertmanagerConfig: telegram-alerts

    ingress:
      enabled: true
      ingressClassName: nginx
      hosts:
        - alertmanager.k8s.javydekoning.com
      paths:
        - /
      tls:
        - hosts:
            - alertmanager.k8s.javydekoning.com
          secretName: javydekoning-com-tls

  grafana:
    ingress:
      enabled: true
      ingressClassName: nginx
      hosts:
        - grafana.k8s.javydekoning.com
      paths:
        - /
      tls:
        - hosts:
            - grafana.k8s.javydekoning.com
          secretName: javydekoning-com-tls

  prometheus:
    prometheusSpec:
      serviceMonitorSelectorNilUsesHelmValues: false
    ingress:
      enabled: true
      ingressClassName: nginx
      hosts:
        - prometheus.k8s.javydekoning.com
      paths:
        - /
      tls:
        - hosts:
            - prometheus.k8s.javydekoning.com
          secretName: javydekoning-com-tls

  prometheus-node-exporter:
    hostRootFsMount:
      enabled: false
