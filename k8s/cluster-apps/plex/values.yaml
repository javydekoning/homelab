plex:
  image:
    # -- image repository
    repository: ghcr.io/k8s-at-home/plex
    # -- image tag
    tag: latest
    # -- image pull policy
    pullPolicy: IfNotPresent

  env:
    TZ: Europe/Amsterdam
    ADVERTISE_IP: 192.168.1.250
    ALLOWED_NETWORKS: "10.0.0.0/8,172.16.0.0/16,192.168.1.0/24"
    # cat /config/Library/Application\ Support/Plex\ Media\ Server/Preferences.xml | tr " " "\n" | \
    # sed -n '/<Preferences/,$p' | tail -n +2 | sed 's,/>,,g' | \
    # sed '/\(OldestPreviousVersion\|MachineIdentifier\|^PlexOnline\|Certificate\|PubSub\|NeedsUpdate\)/d' | \
    # sed 's/"//g' | awk '{print "PLEX_PREFERENCE_"i++": \""$0"\""}'
    PLEX_PREFERENCE_1: "TranscoderTempDirectory=/transcode"
    PLEX_PREFERENCE_2: "FriendlyName=plex.k8s.javydekoning.com"
    PLEX_PREFERENCE_3: "HardwareAcceleratedCodecs=1"
    PLEX_PREFERENCE_4: "autoEmptyTrash=1"
    PLEX_PREFERENCE_5: "AcceptedEULA=1"
    PLEX_PREFERENCE_6: "DisableTLSv1_0=1"
    PLEX_PREFERENCE_7: "RelayEnabled=0"
    PLEX_PREFERENCE_8: "TreatWanIpAsLocal=0"
    PLEX_PREFERENCE_9: "customConnections=https://192.168.1.250:32400"

  service:
    main:
      primary: true
      type: LoadBalancer
      loadBalancerIP: 192.168.1.250
      annotations:
        metallb.universe.tf/allow-shared-ip: plex
      ports:
        http:
          port: 32400

  ingress:
    # -- Enable and configure ingress settings for the chart under this key.
    # @default -- See values.yaml
    main:
      enabled: true
      hosts:
        - host: plex.k8s.javydekoning.com
          paths:
            - path: /

  persistence:
    config:
      enabled: true
      type: hostPath
      accessMode: ReadWriteOnce
      hostPath: /downloads/config/plex
      mountPath: /config
    transcode:
      enabled: true
      type: emptyDir
      mountPoint: /transcode
    tv:
      enabled: true
      type: hostPath
      accessMode: ReadWriteOnce
      hostPath: /downloads/tv
      mountPath: /tv
    movies:
      enabled: true
      type: hostPath
      accessMode: ReadWriteOnce
      hostPath: /downloads/movies
      mountPath: /movies
    education:
      enabled: true
      type: hostPath
      accessMode: ReadWriteOnce
      hostPath: /downloads/education
      mountPath: /education
  podSecurityContext:
    runAsUser: 911
    runAsGroup: 911
    fsGroup: 911
  resources:
    requests:
      memory: "2Gi"
      cpu: "1"
      gpu.intel.com/i915: 1
    limits:
      memory: "8Gi"
      cpu: "4"
      gpu.intel.com/i915: 1