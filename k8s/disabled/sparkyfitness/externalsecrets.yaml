apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: external-sparkyfitness-s3-credentials
  namespace: sparkyfitness
spec:
  refreshInterval: 1h
  secretStoreRef:
    kind: ClusterSecretStore
    name: aws-secretsmanager
  target:
    name: sparkyfitness-s3-credentials
    template:
      engineVersion: v2
      data:
        ACCESS_KEY_ID: "{{ .KOPIA_BUCKET_ACCESS_KEY_ID }}"
        SECRET_ACCESS_KEY: "{{ .KOPIA_BUCKET_SECRET_ACCESS_KEY }}"
        REGION: "eu-west-1"
  dataFrom:
    - extract:
        key: k8s-homelab-secrets
        property: kopia
---
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: external-sparkyfitness-db-credentials
  namespace: sparkyfitness
spec:
  refreshInterval: 1h
  secretStoreRef:
    kind: ClusterSecretStore
    name: aws-secretsmanager
  target:
    name: sparkyfitness-db-credentials
    template:
      engineVersion: v2
      data:
        username: "{{ .SPARKY_USER }}"
        password: "{{ .SPARKY_DB_PASS }}"
  dataFrom:
    - extract:
        key: k8s-homelab-secrets
        property: sparky
---
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: external-sparkyfitness-db-super-credentials
  namespace: sparkyfitness
spec:
  refreshInterval: 1h
  secretStoreRef:
    kind: ClusterSecretStore
    name: aws-secretsmanager
  target:
    name: sparkyfitness-db-credentials
    template:
      engineVersion: v2
      data:
        username: "{{ .SUPER_USER }}"
        password: "{{ .SUPER_PW }}"
  dataFrom:
    - extract:
        key: k8s-homelab-secrets
        property: sparky
