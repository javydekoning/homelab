---
- hosts: all
  vars_files:
    - default.config.yml

  tasks:
    - name: dump ipv4
      debug: var=ansible_default_ipv4.address
    - name: Set DNS Conf
      import_tasks: ansible-tasks/dns.yml
    - name: handle apk installs, update and upgrade
      import_tasks: ansible-tasks/apk.yml
    # - name: handle pip installs, update and upgrade
    #   import_tasks: ansible-tasks/pip.yml
    # - name: prepare host for k3s install
    #   import_tasks: ansible-tasks/prereq.yml
    # - name: install k3s
    #   import_tasks: ansible-tasks/k3s.yml
    # - name: setup metallb
    #   import_tasks: ansible-tasks/metallb.yml
    # - name: setup helm
    #   import_tasks: ansible-tasks/helm.yml
    # - name: setup argocd
    #   import_tasks: ansible-tasks/argocd.yml
    # - name: copy cluster apps
    #   import_tasks: ansible-tasks/copy-cluster-apps.yml
  handlers:
    - name: update extlinux
      shell: |-
        update-extlinux
    - name: reboot
      reboot:
