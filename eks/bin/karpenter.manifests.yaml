apiVersion: karpenter.sh/v1alpha5
kind: Provisioner
metadata:
  name: default
spec:
  consolidation:
    enabled: true
  providerRef:
    name: default
  requirements:
    - key: karpenter.sh/capacity-type
      operator: In
      values:
        - spot
        - on-demand
    - key: kubernetes.io/arch
      operator: In
      values:
        - amd64
        - arm64
    - key: topology.kubernetes.io/zone
      operator: In
      values:
        - eu-west-1a
        - eu-west-1b
        - eu-west-1c
    - key: karpenter.k8s.aws/instance-generation
      operator: Gt
      values:
        - "3"
    - key: kubernetes.io/os
      operator: In
      values:
        - linux
  ttlSecondsUntilExpired: 604800
---
apiVersion: karpenter.k8s.aws/v1alpha1
kind: AWSNodeTemplate
metadata:
  name: default
spec:
  amiFamily: Bottlerocket
  securityGroupSelector:
    kubernetes.io/cluster/eks-blueprint: owned
  subnetSelector:
    karpenter.sh/discovery: eks-blueprint
