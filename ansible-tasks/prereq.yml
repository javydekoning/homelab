---
- name: Create a directory if it does not exist
  ansible.builtin.file:
    path: "{{ item }}"
    state: directory
    mode: "0755"
  loop: "{{ dirs_to_create }}"

- name: Create files if non-existent
  ansible.builtin.file:
    path: "{{ item }}"
    state: touch
    access_time: preserve
  loop: "{{ files_to_create }}"

- name: Enable IPv4 forwarding
  sysctl:
    name: net.ipv4.ip_forward
    value: "1"
    state: present
    reload: yes

# - name: Add kernel opts
#   ansible.builtin.lineinfile:
#     path: /etc/update-extlinux.conf
#     line: default_kernel_opts="...  cgroup_enable=cpuset cgroup_memory=1 cgroup_enable=memory"
#   notify:
#     - update extlinux
#     - reboot

# - name: Flush handlers
#   meta: flush_handlers

- name: Set .zshrc
  copy:
    src: ./dotfiles/.zshrc
    dest: "/{{ ansible_user }}/.zshrc"

- name: Set .tmux.conf
  copy:
    src: ./dotfiles/.tmux.conf
    dest: "/{{ ansible_user }}/.tmux.conf"

# Currently bugged: https://github.com/ansible/ansible/issues/61911
- name: change user shell to zsh
  become: yes
  user:
    name: "{{ ansible_user }}"
    shell: /bin/zsh
